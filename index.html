<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ø®Ø¯Ù…Ø© ÙˆØµÙØªÙŠ â€“ ØµÙŠØ¯Ù„ÙŠØ§Øª Ø´Ù…Ø³</title>
<style>
  :root{
    --primary:#0284c7; --primary-dark:#0369a1;
    --success:#16a34a; --danger:#dc2626;
    --bg:#f1f5f9; --ink:#0f172a; --muted:#64748b;
    --radius:16px;
  }
  body{font-family:Tahoma,Arial,sans-serif;margin:0;background:linear-gradient(180deg,#eef6ff,#f8fafc)}
  .wrap{max-width:760px;margin:22px auto;background:#fff;border-radius:var(--radius);box-shadow:0 10px 28px rgba(2,8,23,.08);padding:22px}
  .brand{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .brand img{height:48px;width:auto;border-radius:12px;object-fit:cover;display:block}
  .brand .title{font-weight:800;color:var(--ink);font-size:18px}
  h1{margin:8px 0 6px;font-size:24px;color:var(--ink)}
  p{margin:0;color:#334155}

  .seg{display:flex;gap:10px;margin:14px 0 18px}
  .seg button{flex:1;padding:14px;border-radius:14px;border:1px solid #cbd5e1;background:#e2e8f0;font-weight:800;cursor:pointer}
  .seg button.active{background:var(--primary);color:#fff;border-color:var(--primary-dark);box-shadow:0 6px 14px rgba(2,132,199,.25)}

  label{display:block;margin:12px 0 6px;font-weight:700;color:var(--ink)}
  input,textarea{width:100%;padding:12px;border:1px solid #cbd5e1;border-radius:12px;font-size:15px;outline:none}
  input:focus,textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(2,132,199,.15)}
  textarea{min-height:84px}

  .btn{width:100%;padding:16px;border:none;border-radius:14px;font-size:17px;font-weight:900;cursor:pointer}
  .btn-primary{background:var(--primary);color:#fff;transition:transform .08s ease, box-shadow .2s ease}
  .btn-primary:hover{transform:translateY(-1px);box-shadow:0 10px 18px rgba(2,132,199,.25)}
  .btn-primary.pulse{animation:pulse 1.4s infinite}
  .btn-primary.sending{animation:sending .8s ease-in-out 1}
  @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(2,132,199,.35)}70%{box-shadow:0 0 0 14px rgba(2,132,199,0)}100%{box-shadow:0 0 0 0 rgba(2,132,199,0)}}
  @keyframes sending{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}

  .muted{color:var(--muted);font-size:13px}
  .error{color:var(--danger);margin-top:8px;font-size:14px}
  #doneView{text-align:center}
  .footer{margin-top:18px;text-align:center;color:#64748b;font-size:13px}

  .toast{position:fixed;top:16px;left:50%;transform:translateX(-50%);background:#111827;color:#fff;padding:12px 16px;border-radius:12px;box-shadow:0 10px 24px rgba(0,0,0,.2);opacity:0;pointer-events:none;transition:opacity .25s ease, transform .25s ease;z-index:9999}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

  .promo{display:none;margin:14px 0 12px;background:linear-gradient(90deg,#0ea5e9,#22c55e);color:#fff;
         padding:12px 14px;border-radius:12px;font-weight:800;box-shadow:0 10px 22px rgba(2,132,199,.22)}
  .promo .small{display:block;font-weight:600;opacity:.9;font-size:13px;margin-top:4px}
</style>
</head>
<body>
<div class="wrap">
  <!-- Ù„ÙˆØ¬Ùˆ (Ø§Ø±ÙØ¹ logo.jpg ÙÙŠ Ø§Ù„Ø¬Ø°Ø±) -->
  <div class="brand">
    <img src="logo.jpg" alt="Shams Pharmacy" onerror="this.style.display='none'">
    <div class="title">Ø®Ø¯Ù…Ø© ÙˆØµÙØªÙŠ â€“ ØµÙŠØ¯Ù„ÙŠØ§Øª Ø´Ù…Ø³</div>
  </div>
  <p class="muted">Ø§Ø®ØªÙØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ø³ØªÙ„Ø§Ù… ÙˆØµÙØªÙƒ Ø«Ù… Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.</p>

  <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© -->
  <div class="seg" id="modeSeg">
    <button data-mode="pickup" class="active">ğŸš¶â€â™‚ï¸ Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹</button>
    <button data-mode="delivery">ğŸ  ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„</button>
  </div>

  <!-- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
  <div id="formView">
    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
    <input id="id_number" type="text" placeholder="1012345678">

    <label>Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙØ©</label>
    <input id="rx_number" type="text" placeholder="A123456789">

    <div id="deliveryBlock" style="display:none;">
      <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
      <input id="mobile" type="tel" placeholder="05xxxxxxxx">

      <label>ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ</label>
      <button id="locBtn" class="btn btn-primary" style="margin-top:6px">ğŸ“ Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø¢Ù†</button>
      <div id="locStatus" class="muted" style="margin-top:6px"></div>

      <label>ÙˆØµÙ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
      <textarea id="addr" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ + Ø£Ù‚Ø±Ø¨ Ù…Ø¹Ù„Ù…"></textarea>
    </div>

    <div style="margin-top:10px">
      <input id="consent" type="checkbox"> Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ù„ØºØ±Ø¶ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨
    </div>

    <button class="btn btn-primary pulse" id="sendBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
    <div id="errorMsg" class="error"></div>
  </div>

  <!-- Ø§Ù„ØªØ£ÙƒÙŠØ¯ + Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„ØªØ±ÙˆÙŠØ¬ÙŠ -->
  <div id="doneView" style="display:none">
    <div id="promoBanner" class="promo">
      Ø§ØµØ±Ù ÙˆØµÙØªÙƒ Ù…Ù† ØµÙŠØ¯Ù„ÙŠØ§Øª Ø´Ù…Ø³ ÙˆØ§ÙƒØ³Ø¨ Ù†Ù‚Ø§Ø· ÙˆÙ„Ø§Ø¡ ØªØªØ­ÙˆÙ„ Ø®ØµÙ… Ø¹Ù„Ù‰ Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ ğŸ’™
      <span class="small">Ù„Ø§ ØªÙ†Ø³Ù ØªÙØ¹ÙŠÙ„ Ø±Ù‚Ù…Ùƒ Ø¹Ù†Ø¯ Ø§Ù„ØµØ±Ù Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·.</span>
    </div>

    <h2 style="color:var(--success)">âœ… ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨</h2>
    <p>ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.</p>
    <a id="waLink" class="btn btn-primary" style="display:block;margin-bottom:12px" target="_blank">ğŸ”— ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>
    <button id="newReq" class="btn" style="background:#e5e7eb">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
  </div>

  <div class="footer">
    ØµÙŠØ¯Ù„ÙŠØ© Ø´Ù…Ø³ â€“ Ø­ÙŠ Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ â€“ Ø´Ø§Ø±Ø¹ Ø§Ø¨Ù† Ø­Ø¬Ø± â€¢ ÙˆØ§ØªØ³Ø§Ø¨: 0592627644
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast">ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ âœ…</div>

<script>
(function(){
  const WHATSAPP = "966592627644"; // Ø¨Ø¯ÙˆÙ† +
  const EMO_PICKUP = "ğŸš¶â€â™‚ï¸", EMO_DELIVERY = "ğŸ ", EMO_PIN = "ğŸ“";

  const modeSeg=document.getElementById("modeSeg");
  const deliveryBlock=document.getElementById("deliveryBlock");
  const idEl=document.getElementById("id_number");
  const rxEl=document.getElementById("rx_number");
  const mobileEl=document.getElementById("mobile");
  const addrEl=document.getElementById("addr");
  const consentEl=document.getElementById("consent");
  const locStatus=document.getElementById("locStatus");
  const errorMsg=document.getElementById("errorMsg");
  const formView=document.getElementById("formView");
  const doneView=document.getElementById("doneView");
  const waLink=document.getElementById("waLink");
  const toast=document.getElementById("toast");
  const promo=document.getElementById("promoBanner");
  const sendBtn=document.getElementById("sendBtn");

  let mode="pickup";
  let gpsLink="";

  // --------- Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† localStorage Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© ----------
  const SAVED = localStorage.getItem("shams_wasfaty_state");
  if (SAVED) {
    try {
      const st = JSON.parse(SAVED);
      if (st && st.done) {
        // Ø«Ø¨Ù‘Øª ØµÙØ­Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
        formView.style.display = "none";
        doneView.style.display = "block";
        promo.style.display = "block";
        waLink.href = st.waURL || "#";
        // Ù…Ø§ Ù†Ù…Ø³Ø­Ø´ Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ø§ Ù„Ù…Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¶ØºØ· "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯"
      }
    } catch(e){}
  }
  // -------------------------------------------------------------------

  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
  modeSeg.addEventListener("click",(e)=>{
    const b=e.target.closest("button[data-mode]");
    if(!b) return;
    mode=b.dataset.mode;
    [...modeSeg.children].forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    deliveryBlock.style.display=(mode==="delivery")?"block":"none";
  });

  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
  document.getElementById("locBtn").onclick=()=>{
    locStatus.textContent="â³ Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";
    if(!navigator.geolocation){ locStatus.textContent="âš  Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹"; return; }
    navigator.geolocation.getCurrentPosition(pos=>{
      gpsLink=`https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
      locStatus.textContent="âœ… ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ù…ÙˆÙ‚Ø¹Ùƒ";
    },()=>{
      locStatus.textContent="âš  ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹";
    },{enableHighAccuracy:true,timeout:12000,maximumAge:0});
  };

  function buildMessage(){
    let m=(mode==="pickup"? `${EMO_PICKUP} Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹` : `${EMO_DELIVERY} ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„`)+"\n";
    m+=`Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: ${idEl.value}\n`;
    m+=`Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙØ©: ${rxEl.value}\n`;
    if(mode==="delivery"){
      m+=`Ø§Ù„Ø¬ÙˆØ§Ù„: ${mobileEl.value}\n`;
      m+=`Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${addrEl.value}\n`;
      m+=`${EMO_PIN} Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${gpsLink||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}\n`;
    }
    m+=`\n*ØªÙ…Øª Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª*`;
    return m;
  }

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
  sendBtn.addEventListener("click", ()=>{
    errorMsg.textContent="";
    sendBtn.classList.add("sending");

    if(!idEl.value || !rxEl.value){ errorMsg.textContent="âš  Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙØ©"; return sendBtn.classList.remove("sending"); }
    if(!consentEl.checked){ errorMsg.textContent="âš  Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨"; return sendBtn.classList.remove("sending"); }
    if(mode==="delivery"){
      if(!mobileEl.value){ errorMsg.textContent="âš  Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„"; return sendBtn.classList.remove("sending"); }
      if(!gpsLink){ errorMsg.textContent="âš  ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„ØªÙˆØµÙŠÙ„"; return sendBtn.classList.remove("sending"); }
    }

    const msg=buildMessage();
    const waURL="https://wa.me/"+WHATSAPP+"?text="+encodeURIComponent(msg);

    // --------- Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ù‚Ø¨Ù„ ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ (Ø¹Ù„Ø´Ø§Ù† ØªØ«Ø¨ÙŠØª ØµÙØ­Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ø±Ø¬ÙˆØ¹) ----------
    localStorage.setItem("shams_wasfaty_state", JSON.stringify({
      done:true, waURL: waURL, ts: Date.now()
    }));
    // --------------------------------------------------------------------------------------

    // ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø©
    window.location.href = waURL;

    // Ù„Ùˆ Ø±Ø¬Ø¹ Ø§Ù„Ù…ØªØµÙØ­ØŒ Ù†Ø¸Ù‡Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ + Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„ØªØ±ÙˆÙŠØ¬ÙŠ
    formView.style.display="none";
    doneView.style.display="block";
    promo.style.display="block";
    waLink.href=waURL;

    // ØªÙˆØ³Øª Ø¨Ø³ÙŠØ·
    showToast("ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ âœ…");
    setTimeout(()=>sendBtn.classList.remove("sending"), 900);
  });

  // ØªÙˆØ³Øª
  function showToast(msg){
    toast.textContent=msg||"ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©";
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 2200);
  }

  // Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯: Ø§Ù…Ø³Ø­ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ø±Ø¬Ø¹ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬
  document.getElementById("newReq").onclick=()=>{
    localStorage.removeItem("shams_wasfaty_state");
    location.reload();
  };
})();
</script>
</body>
</html>
