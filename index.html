<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø®Ø¯Ù…Ø© ÙˆØµÙØªÙŠ â€“ ØµÙŠØ¯Ù„ÙŠØ§Øª Ø´Ù…Ø³</title>
<style>
  body{ font-family:Tahoma,Arial,sans-serif; background:#f7fafc; margin:0; }
  .wrap{ max-width:720px; margin:24px auto; background:#fff; border-radius:14px; padding:20px; box-shadow:0 5px 20px rgba(0,0,0,0.08); }
  h1{ margin:0 0 10px; font-size:24px; }
  .seg{ display:flex; gap:10px; margin-bottom:12px; }
  .seg button{ flex:1; padding:12px; border-radius:10px; border:1px solid #ddd; background:#f8fafc; font-weight:700; cursor:pointer; }
  .seg button.active{ background:#0ea5e9; color:#fff; border-color:#0ea5e9; }
  .card{ padding:16px; border:1px solid #ddd; border-radius:10px; }
  label{ display:block; font-weight:600; margin-bottom:6px; }
  input,textarea{ width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; }
  textarea{ min-height:70px; }
  .actions{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
  .btn{ border:none; padding:12px 16px; border-radius:10px; cursor:pointer; font-weight:700; }
  .primary{ background:#16a34a; color:#fff; }
  .sec{ background:#0ea5e9; color:#fff; }
  .danger{ background:#ef4444; color:#fff; }
  .hidden{ display:none; }
  .status{ margin-top:8px; }
  .success{ color:#16a34a; }
  .error{ color:#ef4444; }
  .footer{ text-align:center; margin-top:20px; color:#666; font-size:12px; }
</style>
</head>

<body>
<div class="wrap">

<h1>Ø®Ø¯Ù…Ø© ÙˆØµÙØªÙŠ â€“ ØµÙŠØ¯Ù„ÙŠØ§Øª Ø´Ù…Ø³</h1>
<p>ÙƒÙŠÙ ØªØ­Ø¨ ØªØ³ØªÙ„Ù… ÙˆØµÙØªÙƒØŸ</p>

<div class="seg" id="modeSeg">
  <button data-mode="pickup" class="active">ğŸš¶â€â™‚ï¸ Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹</button>
  <button data-mode="delivery">ğŸ  ØªÙˆØµÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø²Ù„</button>
</div>

<div class="card" id="formView">

<label>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© (Ù…Ø·Ù„ÙˆØ¨)</label>
<input id="id_number" type="text" placeholder="1012345678" />

<label style="margin-top:10px;">Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙØ© (Ù‚Ø¯ ÙŠØ¨Ø¯Ø£ Ø¨Ø­Ø±Ù)</label>
<input id="rx_number" type="text" placeholder="A123456789" />

<div id="deliveryBlock" class="hidden" style="margin-top:14px;">
  <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ù„ØªÙˆØµÙŠÙ„</label>
  <input id="mobile" type="tel" placeholder="05xxxxxxxx" />

  <div class="actions">
    <button class="sec" type="button" id="locBtn">ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ</button>
    <button class="danger" type="button" id="clearLoc">Ù…Ø³Ø­</button>
  </div>

  <label style="margin-top:10px;">ÙˆØµÙ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
  <textarea id="addr" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ + Ø£Ù‚Ø±Ø¨ Ù…Ø¹Ù„Ù…"></textarea>

  <label style="margin-top:10px;">Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
  <input id="maps_link" type="text" placeholder="https://maps.app.goo.gl/..." />
</div>

<div id="locStatus" class="status"></div>

<div style="margin-top:10px;">
 <input id="consent" type="checkbox"> Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ù„ØºØ±Ø¶ ØªØ¬Ù‡ÙŠØ²/ØªÙˆØµÙŠÙ„ Ø§Ù„Ø£Ø¯ÙˆÙŠØ©
</div>

<div class="actions">
  <button class="btn primary" id="sendBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
</div>

</div>

<div class="card hidden" id="doneView">
  <h2 class="success">âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</h2>
  <p id="summary"></p>
  <a id="waLink" class="btn sec" target="_blank">ğŸ“© ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</a>
  <button id="newReq" class="btn primary">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
</div>

<div class="footer">ØµÙŠØ¯Ù„ÙŠØ© Ø´Ù…Ø³ â€“ Ø­ÙŠ Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ â€“ Ø´Ø§Ø±Ø¹ Ø§Ø¨Ù† Ø­Ø¬Ø±</div>

</div>

<script>
(function(){
  const WHATSAPP = "966592627644";
  const formView = document.getElementById("formView");
  const doneView = document.getElementById("doneView");
  const modeSeg = document.getElementById("modeSeg");
  const deliveryBlock = document.getElementById("deliveryBlock");
  const idEl = document.getElementById("id_number");
  const rxEl = document.getElementById("rx_number");
  const mobileEl = document.getElementById("mobile");
  const addrEl = document.getElementById("addr");
  const mapsEl = document.getElementById("maps_link");
  const consentEl = document.getElementById("consent");
  const locStatus = document.getElementById("locStatus");
  const waLink = document.getElementById("waLink");

  let mode = "pickup";
  let gpsLink = "";

  modeSeg.addEventListener("click", (e)=>{
    const b = e.target.closest("button[data-mode]");
    if(!b) return;
    mode = b.dataset.mode;
    [...modeSeg.children].forEach(btn=>btn.classList.remove("active"));
    b.classList.add("active");
    deliveryBlock.classList.toggle("hidden", mode!=="delivery");
  });

  document.getElementById("locBtn").onclick = () =>{
    if(!navigator.geolocation){
      locStatus.innerHTML = "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.";
      return;
    }
    navigator.geolocation.getCurrentPosition(pos=>{
      gpsLink = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
      locStatus.innerHTML = "âœ” ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ù…ÙˆÙ‚Ø¹Ùƒ";
    },()=>{
      locStatus.innerHTML = "âš  ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹";
    });
  };

  document.getElementById("clearLoc").onclick = ()=>{
    gpsLink=""; locStatus.innerHTML="";
  };

  function buildMessage(){
    let msg = "";
    msg += (mode==="pickup"? "ğŸ”” Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹":"ğŸšš ØªÙˆØµÙŠÙ„ Ù„Ù„Ø¨ÙŠØª")+"\n";
    msg += "Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: "+idEl.value+"\n";
    msg += "Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙØ©: "+rxEl.value+"\n";
    if(mode==="delivery"){
      if(mobileEl.value) msg += "Ø§Ù„Ø¬ÙˆØ§Ù„: "+mobileEl.value+"\n";
      if(addrEl.value) msg += "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: "+addrEl.value+"\n";
      if(gpsLink) msg += "Ø§Ù„Ù…ÙˆÙ‚Ø¹: "+gpsLink+"\n";
      else if(mapsEl.value) msg += "Ø§Ù„Ù…ÙˆÙ‚Ø¹: "+mapsEl.value+"\n";
    }
    msg += "*ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª*";
    return msg;
  }

  document.getElementById("sendBtn").onclick = ()=>{
    if(!idEl.value || !rxEl.value) return alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„ÙˆØµÙØ©");
    if(!consentEl.checked) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù„Ù„Ù…ÙˆØ§ØµÙ„Ø©");
    if(mode==="delivery" && !mobileEl.value) return alert("Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØªÙˆØµÙŠÙ„");

    const msg = buildMessage();
    waLink.href = "https://wa.me/"+WHATSAPP+"?text="+encodeURIComponent(msg);
    formView.classList.add("hidden");
    doneView.classList.remove("hidden");
    document.getElementById("summary").innerHTML = msg.replace(/\n/g,"<br>");
  };

  document.getElementById("newReq").onclick = ()=>{
    location.reload();
  };
})();
</script>
</body>
</html>
